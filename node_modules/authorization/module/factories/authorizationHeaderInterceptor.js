/**
 * User: Kupin.R
 * Date: 12/4/13
 */


angular
    .module('whatwanted.AuthorizationModule')
    .factory('authorizationHeaderInterceptor', ['$injector', 'authorizationUrlConstants', function ($injector, constants) {

        function fixUpConfig(config) {
            config = config || {};
            config.headers = config.headers || {};
            return config;
        }

        return {
            'request': function (config) {
                var ticket, authService = $injector.get('authService'), config = fixUpConfig(config);
                if (angular.isDefined(config.headers[constants.AUTH_TOKEN_HEADER]) === false &&
                    (angular.isDefined(ticket = authService.getTicket())) && !angular.equals(config.cleanRequest, true)) {

                    config.headers[constants.AUTH_TOKEN_HEADER] = ticket;
                }
                return config;
            }
        };
    }]);
